{
  "client_name": "Opyn",
  "commit_hash": "1248e6606feb3279a94104df6c6dfcb8d46271f4",
  "date": "July 2021",
  "date_interval": "26th to 30th of July, 2021",
  "issues": [{
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nA Vault owner can call `rollOver` function in order to distribute the funds to the actions. The `_allocationPercentages` argument deals with how much each action should have allocated as a percentage of the available funds in the Vault:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L336-L341\r\n\r\nThe `_distribute` function is responsible for ensuring that each action has allocated its respective share of funds: \r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L434-L443\r\n\r\nThe issue is that there is no restriction about a maximum or minimum percentage allocation per action. This means that an owner can allocate 100% to only one action, irrespective of how many actions have been defined in the Vault.\r\n\r\nThis makes a Vault less transparent for its potential users since ultimately the owner can decide to allocate all the funds to only one (highly risky) action.\r\n\r\n**Recommendation**\r\n\r\nIn order to reduce the amount of trust that a user needs to place in a Vault owner, a `minActionAllocationPercentage` parameter should be added to the contract. It can be specified in the `init` function, along with the other Vault parameters.  Once set this action should not be allowed to change (ie. no setter function).\r\n\r\nThe `minActionAllocationPercentage` parameter will specify a minimum allocation percentage for each action in the Vault. It will make the behavior of the system more predictable and transparent to its users. Even if set to 0 by the owner, its presence ensures that users know what they are signing up to when depositing assets into the vault.\r\n\r\nNB: care should be taken to ensure correct validation of its value during the `init` stage. For example, having a 34% value for this parameter for a Vault with 3 actions would render the contract unable to allocate funds during `rollOver` stage.",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/10/comments",
      "created_at": "2021-07-30T05:39:23Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/10/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/10",
      "id": 956421189,
      "labels": [{
          "color": "FF9500",
          "default": false,
          "description": null,
          "id": 3203450887,
          "name": "Medium",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODg3",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Medium"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/10/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTY0MjExODk=",
      "number": 10,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "A Vault owner can allocate 100% to one action",
      "updated_at": "2021-07-30T05:58:14Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/10",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
        "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
        "followers_url": "https://api.github.com/users/andreiashu/followers",
        "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
        "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/andreiashu",
        "id": 342638,
        "login": "andreiashu",
        "node_id": "MDQ6VXNlcjM0MjYzOA==",
        "organizations_url": "https://api.github.com/users/andreiashu/orgs",
        "received_events_url": "https://api.github.com/users/andreiashu/received_events",
        "repos_url": "https://api.github.com/users/andreiashu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/andreiashu"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nWhen the vault is locked, the users can still queue deposits and withdraws. However, they cannot be immediately accessed, so specific accounting needs to be done.\r\n\r\nUsers call `registerDeposit`:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/3d44603300dd9abffe5a1c1e1c2647e9f6b80c7b/code/contracts/core/OpynPerpVault.sol#L245\r\n\r\nThe funds they wish to deposit are moved into the vault.\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/3d44603300dd9abffe5a1c1e1c2647e9f6b80c7b/code/contracts/core/OpynPerpVault.sol#L246\r\n\r\nAnd the accounting needs to be done for this user, to be handled later.\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/3d44603300dd9abffe5a1c1e1c2647e9f6b80c7b/code/contracts/core/OpynPerpVault.sol#L249-L251\r\n\r\nOn top of the initial value of `userRoundQueuedDepositAmount[_shareRecipient][round]` we need to add the current deposited value of `_amount`.\r\n\r\nHowever, a copy/paste artifact from `registerWithdraw` was left in the code, the initial value used is `userRoundQueuedWithdrawShares[_shareRecipient][round]` instead of `userRoundQueuedDepositAmount[_shareRecipient][round]`.\r\n\r\n**Recommendation**\r\n\r\nUpdate the accounting to reflect the correct initial value of the queued deposit.\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/9/comments",
      "created_at": "2021-07-29T15:30:25Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/9/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/9",
      "id": 955961952,
      "labels": [{
          "color": "ff3b30",
          "default": false,
          "description": null,
          "id": 3203450928,
          "name": "Major",
          "node_id": "MDU6TGFiZWwzMjAzNDUwOTI4",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Major"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/9/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTU5NjE5NTI=",
      "number": 9,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "Registering a deposit uses the incorrect initial value for the user",
      "updated_at": "2021-07-30T05:55:17Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/9",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
        "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
        "followers_url": "https://api.github.com/users/cleanunicorn/followers",
        "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cleanunicorn",
        "id": 547012,
        "login": "cleanunicorn",
        "node_id": "MDQ6VXNlcjU0NzAxMg==",
        "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
        "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
        "repos_url": "https://api.github.com/users/cleanunicorn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cleanunicorn"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\n`rollOver` function is called by the admin in order to allocate different weights to actions in the Vault:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L336\r\n\r\nIn turn, the `_distribute` function is called which distributes the tokens according to the percentage allocation of each action:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L434-L435\r\n\r\nThe issue is that the `Rollover` event is called regardless of the effective balance of the contract:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L339\r\n\r\n**Recommendation**\r\n\r\nEnsure that the event is emitted only for non-null balances - when funds are actually allocated to actions.\r\n",
      "closed_at": "2021-07-30T01:05:19Z",
      "comments": 1,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/8/comments",
      "created_at": "2021-07-29T11:03:56Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/8/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/8",
      "id": 955722828,
      "labels": [],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/8/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTU3MjI4Mjg=",
      "number": 8,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "closed",
      "title": "`rollOver` emits an event for 0 balance",
      "updated_at": "2021-07-30T05:42:38Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/8",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
        "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
        "followers_url": "https://api.github.com/users/andreiashu/followers",
        "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
        "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/andreiashu",
        "id": 342638,
        "login": "andreiashu",
        "node_id": "MDQ6VXNlcjM0MjYzOA==",
        "organizations_url": "https://api.github.com/users/andreiashu/orgs",
        "received_events_url": "https://api.github.com/users/andreiashu/received_events",
        "repos_url": "https://api.github.com/users/andreiashu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/andreiashu"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\n`withdrawFromQueue` can be called by anyone in order to withdraw deposited tokens from a round:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L305-L306\r\n\r\nThe emitted event is _incorrectly_ using the `withdrawQueueAmount` variable which holds the tokens leftover in the queue to be withdrawn:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L464-L471\r\n\r\n**Recommendation**\r\n\r\nFix the code to reference `withdrawAmount` instead which represents the number of tokens the user deposited in the round.\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/7/comments",
      "created_at": "2021-07-29T09:27:57Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/7/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/7",
      "id": 955644499,
      "labels": [{
          "color": "FF9500",
          "default": false,
          "description": null,
          "id": 3203450887,
          "name": "Medium",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODg3",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Medium"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/7/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTU2NDQ0OTk=",
      "number": 7,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "`withdrawFromQueue` emits the wrong number of tokens withdrawn",
      "updated_at": "2021-07-30T05:53:01Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/7",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
        "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
        "followers_url": "https://api.github.com/users/andreiashu/followers",
        "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
        "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/andreiashu",
        "id": 342638,
        "login": "andreiashu",
        "node_id": "MDQ6VXNlcjM0MjYzOA==",
        "organizations_url": "https://api.github.com/users/andreiashu/orgs",
        "received_events_url": "https://api.github.com/users/andreiashu/received_events",
        "repos_url": "https://api.github.com/users/andreiashu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/andreiashu"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nThe EVM works with 256bit/32byte words. For smaller data types, further operations are performed to downscale from 256 bits to the required lower bites type, and therefore having `uint8` as an iterator consumes more gas than keeping it to `uint256`.\r\n\r\nThere are several places where `uint8` is used as the type for the loop iterator:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/3d44603300dd9abffe5a1c1e1c2647e9f6b80c7b/code/contracts/core/OpynPerpVault.sol#L420\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/3d44603300dd9abffe5a1c1e1c2647e9f6b80c7b/code/contracts/core/OpynPerpVault.sol#L441\r\n\r\n**Recommendation**\r\n\r\n\r\nThe example below shows the difference between 2 variants of code, one using `uint8` and the other `uint256` for the iterators:\r\n\r\n```solidity\r\npragma solidity ^0.6.12;\r\n\r\n/**\r\n * Show the difference in gas costs between a loop that uses a uint8 variable\r\n * and one that uses uint256 variable.\r\n * \r\n * Both contracts compiled with `Enable Optimization` set to 200 runs.\r\n */\r\n\r\ncontract LoopUint8 {\r\n    \r\n    address[] internal arr;\r\n\r\n    // 1st call; arr.length == 0: gas cost 42719\r\n    // 2nd call; arr.length == 1: gas cost 30322\r\n    // 3rd call; arr.length == 2: gas cost 32925\r\n    function add(address _new) public {\r\n        for (uint8 i = 0; i < arr.length; i++) {\r\n          if (arr[i] == _new) {\r\n            require(false, 'exists');\r\n          }\r\n        }\r\n        \r\n        arr.push(_new);\r\n    }\r\n}\r\n\r\n\r\ncontract LoopUint256 {\r\n    \r\n    address[] internal arr;\r\n\r\n    // 1st call; arr.length == 0: gas cost 42713\r\n    // 2nd call; arr.length == 1: gas cost 30304\r\n    // 3rd call; arr.length == 2: gas cost 32895\r\n    function add(address _new) public {\r\n        for (uint256 i = 0; i < arr.length; i++) {\r\n          if (arr[i] == _new) {\r\n            require(false, 'exists');\r\n          }\r\n        }\r\n        \r\n        arr.push(_new);\r\n    }\r\n}\r\n```\r\n\r\n**Recommendation**\r\n\r\nUse `uint256` for the loop iterators.\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/6/comments",
      "created_at": "2021-07-28T13:33:14Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/6/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/6",
      "id": 954860909,
      "labels": [{
          "color": "FFCC00",
          "default": false,
          "description": null,
          "id": 3203450854,
          "name": "Minor",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODU0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Minor"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/6/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTQ4NjA5MDk=",
      "number": 6,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "Prefer using `uint256` instead of a type with less than 256 bits",
      "updated_at": "2021-07-30T05:50:50Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/6",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
        "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
        "followers_url": "https://api.github.com/users/cleanunicorn/followers",
        "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cleanunicorn",
        "id": 547012,
        "login": "cleanunicorn",
        "node_id": "MDQ6VXNlcjU0NzAxMg==",
        "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
        "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
        "repos_url": "https://api.github.com/users/cleanunicorn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cleanunicorn"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nA user can call `registerDeposit` when the vault is locked to add their own funds for the next investment round.\r\n\r\nAfter enough time passes and the round is closed, by calling `closePositions`, the user can come back to the contract to retrieve their locked funds, along with the realized yields.\r\n\r\nIn order to do this, they need to call `claimShares`.\r\n\r\nThe method calculates how many tokens they should have received, in case they were to join when the vault was unlocked and transfers those tokens to the depositor.\r\n\r\nThe calculated value can be zero, either in case the depositor never added tokens, or the depositor already claimed their tokens. However, the transfer happens either way, for 0 tokens or for a positive value of tokens.\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/518e4f6d174cae6ee75e316ad56789aaeb695069/code/contracts/core/OpynPerpVault.sol#L268-L271\r\n\r\n**Recommendation**\r\n\r\nIt might help users (from a UX point of view) and the contract to only send tokens when there are tokens to send. Consider transferring only if there is a positive amount to be sent.\r\n\r\nThis will reduce the number of events the contract emits, and the user knows before committing the transaction if they will receive tokens or not.",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/5/comments",
      "created_at": "2021-07-27T14:57:35Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/5/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/5",
      "id": 953973254,
      "labels": [{
          "color": "FF9500",
          "default": false,
          "description": null,
          "id": 3203450887,
          "name": "Medium",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODg3",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Medium"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/5/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTM5NzMyNTQ=",
      "number": 5,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "`claimShares` should send tokens only if there something to transfer",
      "updated_at": "2021-07-30T05:47:47Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/5",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
        "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
        "followers_url": "https://api.github.com/users/cleanunicorn/followers",
        "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cleanunicorn",
        "id": 547012,
        "login": "cleanunicorn",
        "node_id": "MDQ6VXNlcjU0NzAxMg==",
        "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
        "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
        "repos_url": "https://api.github.com/users/cleanunicorn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cleanunicorn"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nA user can deposit funds in the vault by calling `deposit()` or `registerDeposit()`.\r\n\r\nWhen they are called, the total amount of locked funds are checked to be up to the specified limit, called the `cap`.\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/518e4f6d174cae6ee75e316ad56789aaeb695069/code/contracts/core/OpynPerpVault.sol#L406\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/518e4f6d174cae6ee75e316ad56789aaeb695069/code/contracts/core/OpynPerpVault.sol#L248\r\n\r\nThe check makes sure the amount of funds is strictly less than the limit. This will force the last user joining the vault to send an awkward amount of funds (similar to `99999999`). Allowing the total amount of funds to equal will make the user experience better, and also, the total reported amount of funds displayed will be easier to the eye.\r\n\r\n**Recommendation**\r\n\r\nChange the `require` to accept the sum of deposited amounts to be equal to the cap.\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/4/comments",
      "created_at": "2021-07-27T11:24:36Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/4/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/4",
      "id": 953781547,
      "labels": [{
          "color": "FF9500",
          "default": false,
          "description": null,
          "id": 3203450887,
          "name": "Medium",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODg3",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Medium"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/4/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTM3ODE1NDc=",
      "number": 4,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "Depositing should allow up to or equal to the cap",
      "updated_at": "2021-07-30T05:46:38Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/4",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
        "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
        "followers_url": "https://api.github.com/users/cleanunicorn/followers",
        "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cleanunicorn",
        "id": 547012,
        "login": "cleanunicorn",
        "node_id": "MDQ6VXNlcjU0NzAxMg==",
        "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
        "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
        "repos_url": "https://api.github.com/users/cleanunicorn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cleanunicorn"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nWhen the total reported amount of assets is estimated by the actions, the storage variable `actions.length` is used. This value does not change over time (in this loop) and can be cached in a local variable, instead of retrieving the value from the storage.\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/518e4f6d174cae6ee75e316ad56789aaeb695069/code/contracts/core/OpynPerpVault.sol#L393-L395\r\n\r\nSimilarly for `_closeAndWithdraw()`:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/3d44603300dd9abffe5a1c1e1c2647e9f6b80c7b/code/contracts/core/OpynPerpVault.sol#L420\r\n\r\n**Recommendation**\r\n\r\nCache the length locally and use the local variable in the loop.\r\n\r\n**Reference**\r\n\r\nAn example was created to illustrate the gas difference with or without length cache.\r\n\r\nNot using a cache, for a set of 10 iterations uses **49157 gas**.\r\n\r\n```solidity\r\ncontract SumNumbers {\r\n    uint[] public numbers;\r\n    \r\n    constructor(uint size) {\r\n        // Add some data to work with\r\n        for (uint i = 0; i < size; i++) {\r\n            numbers.push(i);\r\n        }\r\n    }\r\n    \r\n    function sumNumbers() public view returns (uint) {\r\n        uint sum;\r\n        for(uint i = 0; i < numbers.length; i++) {\r\n            sum += numbers[i];\r\n        }\r\n        \r\n        return sum;\r\n    }\r\n}\r\n```\r\n\r\nUsing a cache, for the same set of 10 iterations uses **48168 gas**.\r\n\r\n```solidity\r\ncontract SumNumbersWithCache {\r\n    uint[] public numbers;\r\n    \r\n    constructor(uint size) {\r\n        // Add some data to work with\r\n        for (uint i = 0; i < size; i++) {\r\n            numbers.push(i);\r\n        }\r\n    }\r\n    \r\n    function sumNumbers() public view returns (uint) {\r\n        uint sum;\r\n        uint size = numbers.length;\r\n        \r\n        for(uint i = 0; i < size; i++) {\r\n            sum += numbers[i];\r\n        }\r\n        \r\n        return sum;\r\n    }\r\n}\r\n```\r\n\r\nBoth contracts were compiled with 200 optimization rounds.\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/3/comments",
      "created_at": "2021-07-27T09:53:07Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/3/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/3",
      "id": 953707223,
      "labels": [{
          "color": "FFCC00",
          "default": false,
          "description": null,
          "id": 3203450854,
          "name": "Minor",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODU0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Minor"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/3/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTM3MDcyMjM=",
      "number": 3,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "Cache the length of actions when looping over them",
      "updated_at": "2021-07-30T05:44:57Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/3",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
        "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
        "followers_url": "https://api.github.com/users/cleanunicorn/followers",
        "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cleanunicorn",
        "id": 547012,
        "login": "cleanunicorn",
        "node_id": "MDQ6VXNlcjU0NzAxMg==",
        "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
        "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
        "repos_url": "https://api.github.com/users/cleanunicorn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cleanunicorn"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nThe owner can call `setCap` to set a new limit for the accepted funds.\r\n\r\nAfter the cap was updated, an event is emitted.\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/518e4f6d174cae6ee75e316ad56789aaeb695069/code/contracts/core/OpynPerpVault.sol#L200\r\n\r\nWhen the event is emitted, the storage variable is used. This forces an expensive `SLOAD` operation.\r\n\r\n**Recommendation**\r\n\r\nUse the argument received in the method when emitting the event instead of the storage variable.\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/2/comments",
      "created_at": "2021-07-27T09:31:59Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/2/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/2",
      "id": 953690100,
      "labels": [{
          "color": "FFCC00",
          "default": false,
          "description": null,
          "id": 3203450854,
          "name": "Minor",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODU0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Minor"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/2/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTM2OTAxMDA=",
      "number": 2,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "Improve gas costs by reducing the use of state variables when possible",
      "updated_at": "2021-07-30T05:44:05Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/2",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/547012?v=4",
        "events_url": "https://api.github.com/users/cleanunicorn/events{/privacy}",
        "followers_url": "https://api.github.com/users/cleanunicorn/followers",
        "following_url": "https://api.github.com/users/cleanunicorn/following{/other_user}",
        "gists_url": "https://api.github.com/users/cleanunicorn/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cleanunicorn",
        "id": 547012,
        "login": "cleanunicorn",
        "node_id": "MDQ6VXNlcjU0NzAxMg==",
        "organizations_url": "https://api.github.com/users/cleanunicorn/orgs",
        "received_events_url": "https://api.github.com/users/cleanunicorn/received_events",
        "repos_url": "https://api.github.com/users/cleanunicorn/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cleanunicorn/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cleanunicorn/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cleanunicorn"
      }
    },
    {
      "active_lock_reason": null,
      "assignee": null,
      "assignees": [],
      "author_association": "CONTRIBUTOR",
      "body": "**Description**\r\n\r\nThe `LockState` modifier updates the `state` contract variable to `VaultState.Locked`:\r\n\r\nhttps://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/blob/d94fcb2e2173008272604705a9fc618710349462/code/contracts/core/OpynPerpVault.sol#L116-L120\r\n\r\nThe issue is that the documentation above is confusing.\r\n\r\n**Recommendation**\r\n\r\nReword the documentation text to read (_should_ instead of _can_):\r\n\r\n> should only be executed in the unlocked state\r\n",
      "closed_at": null,
      "comments": 0,
      "comments_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/1/comments",
      "created_at": "2021-07-27T04:52:29Z",
      "events_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/1/events",
      "html_url": "https://github.com/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/1",
      "id": 953500444,
      "labels": [{
          "color": "FFCC00",
          "default": false,
          "description": null,
          "id": 3203450854,
          "name": "Minor",
          "node_id": "MDU6TGFiZWwzMjAzNDUwODU0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Minor"
        },
        {
          "color": "667788",
          "default": false,
          "description": null,
          "id": 3203450744,
          "name": "Report",
          "node_id": "MDU6TGFiZWwzMjAzNDUwNzQ0",
          "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/labels/Report"
        }
      ],
      "labels_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/1/labels{/name}",
      "locked": false,
      "milestone": null,
      "node_id": "MDU6SXNzdWU5NTM1MDA0NDQ=",
      "number": 1,
      "performed_via_github_app": null,
      "repository_url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07",
      "state": "open",
      "title": "OpynPerpVault.onlyLocked() documentation update",
      "updated_at": "2021-07-30T05:39:55Z",
      "url": "https://api.github.com/repos/monoceros-alpha/review-opyn-perp-vault-templates-2021-07/issues/1",
      "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
        "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
        "followers_url": "https://api.github.com/users/andreiashu/followers",
        "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
        "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/andreiashu",
        "id": 342638,
        "login": "andreiashu",
        "node_id": "MDQ6VXNlcjM0MjYzOA==",
        "organizations_url": "https://api.github.com/users/andreiashu/orgs",
        "received_events_url": "https://api.github.com/users/andreiashu/received_events",
        "repos_url": "https://api.github.com/users/andreiashu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/andreiashu"
      }
    }
  ],
  "person_days": "10",
  "project_name": "Perp Vault Templates",
  "review_period": "1 week",
  "source_repository": "https://github.com/opynfinance/perp-vault-templates",
  "template": "./Readme.md.mustache"
}
